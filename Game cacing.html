<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
  <title>üêç Game Snake Lucu + Avatar + Musik</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    body {
      font-family: 'Segoe UI', Tahoma, sans-serif;
      background: linear-gradient(to bottom, #ffe6f0, #fdf6f9);
      text-align: center;
      user-select: none;
      height: 100vh;
      overflow: hidden;
      padding: 10px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    h2 {
      font-size: 20px;
      margin: 10px 0;
    }
    button, a {
      font-size: 14px;
      padding: 8px 16px;
      border-radius: 20px;
      border: none;
      background-color: #ff69b4;
      color: white;
      font-weight: 700;
      box-shadow: 0 0 8px #ff69b4;
      cursor: pointer;
    }
    button:hover, a:hover {
      background-color: #e0559a;
    }
    #music-control, #control-buttons, a {
      margin: 6px;
    }
    #selected-avatar {
      font-size: 36px;
      margin-bottom: 6px;
    }
    #avatar-list {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 6px;
      margin-bottom: 10px;
    }
    .avatar-choice {
      font-size: 24px;
      width: 40px;
      height: 40px;
      line-height: 40px;
      border: 2px solid transparent;
      border-radius: 8px;
      background: #fff0f5;
      cursor: pointer;
    }
    .avatar-choice.selected {
      border-color: #ff69b4;
      background-color: #ffe6f0;
    }
    #game {
      width: 90vw;
      max-width: 320px;
      height: 90vw;
      max-height: 320px;
      background: #fff;
      border: 2px solid #ff69b4;
      border-radius: 14px;
      box-shadow: 0 0 10px #ffb6c1;
      display: block;
      margin: 0 auto;
    }
    #score {
      font-size: 16px;
      color: #d6336c;
      font-weight: bold;
      margin: 4px 0;
    }
    #love-text {
      position: absolute;
      top: 45%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 13px;
      color: #ff1a75;
      background: rgba(255,182,193,0.9);
      padding: 6px 12px;
      border-radius: 18px;
      box-shadow: 0 0 12px #ff1a75;
      opacity: 0;
      pointer-events: none;
      transition: opacity .4s ease;
      font-family: 'Comic Sans MS', cursive;
      z-index: 10;
    }
    #joystick {
      position: fixed;
      bottom: 10px;
      left: 50%;
      transform: translateX(-50%);
      width: 80px;
      height: 80px;
      border: 2px solid #ff69b4;
      background: rgba(255,192,203,0.3);
      border-radius: 50%;
      touch-action: none;
      z-index: 20;
    }
    #stick {
      position: absolute;
      width: 40px;
      height: 40px;
      background: #ff69b4;
      border-radius: 50%;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      transition: 0.1s ease;
    }
  </style>
</head>
<body>

  <div id="music-control">
    <button id="music-toggle">Putar Musik Biar makin seru</button>
  </div>

    <div style="margin-top: 30px;">
  <a href="awalan.html" 
     style="
       display: inline-block;
       background-color: #ff69b4;
       color: white;
       padding: 12px 28px;
       border-radius: 25px;
       font-weight: 700;
       text-decoration: none;
       font-size: 18px;
       box-shadow: 0 0 12px #ff69b4;
       user-select: none;
       transition: background-color 0.3s ease;
     "
     onmouseover="this.style.backgroundColor='#e0559a'"
     onmouseout="this.style.backgroundColor='#ff69b4'">
    ‚Üê Kembali ke HP
  </a>
</div>

  <h2>üêç Snake Game -_-</h2>

  <div id="selected-avatar">üê∞</div>
  <div id="avatar-list">
    <div tabindex="0" class="avatar-choice selected">üê∞</div>
    <div tabindex="0" class="avatar-choice">üê±</div>
    <div tabindex="0" class="avatar-choice">ü¶ä</div>
    <div tabindex="0" class="avatar-choice">üêº</div>
    <div tabindex="0" class="avatar-choice">ü¶Ñ</div>
    <div tabindex="0" class="avatar-choice">üê•</div>
    <div tabindex="0" class="avatar-choice">üê∏</div>
    <div tabindex="0" class="avatar-choice">üê¢</div>
    <div tabindex="0" class="avatar-choice">üêô</div>
    <div tabindex="0" class="avatar-choice">üêØ</div>
  </div>

  <div id="control-buttons">
    <button id="start-button">Mulai</button>
    <button id="restart-button" style="display:none;">Ulang</button>
  </div>

  <div id="score">Skor: 0</div>
  <canvas id="game" width="400" height="400"></canvas>
  <div id="love-text"></div>
  <div id="joystick"><div id="stick"></div></div>

  <script>
    // Audio
    const soundEat = new Audio('hahaha.mp3');
    const soundClick = new Audio('klikgamecacing.mp3');
    const bgMusic = new Audio('kidgame.mp3');
    bgMusic.loop = true; bgMusic.volume = 0.90;

    // Avatar setup
    const avatarChoices = document.querySelectorAll('.avatar-choice');
    let selectedAvatar = 'üê∞';
    const selectedAvatarEl = document.getElementById('selected-avatar');
    avatarChoices.forEach(el => {
      el.addEventListener('click', () => {
        avatarChoices.forEach(a => a.classList.remove('selected'));
        el.classList.add('selected');
        selectedAvatar = el.textContent;
        selectedAvatarEl.textContent = selectedAvatar;
        soundClick.currentTime = 0;
        soundClick.play().catch(() => {});
      });
      el.addEventListener('keydown', e => {
        if(e.key === 'Enter' || e.key === ' ') el.click();
      });
    });

    // Game logic
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    const gridSize = 20, tileCount = 20;
    let snake, velocity, food, score, gameInterval, gameStarted = false;

    const loveTextEl = document.getElementById('love-text');
    function showLoveText() {
      const msgs = ['Kamu manis üçé','Makan tambah cinta üíñ','Ular cinta kamu üêçüíï','Semangat üòä','Cintaku tumbuh üå±','Makan buah makin cantik ü•∞'];
      loveTextEl.textContent = msgs[Math.floor(Math.random()*msgs.length)];
      loveTextEl.style.opacity = 1;
      setTimeout(() => loveTextEl.style.opacity = 0, 3600);
    }

    function updateScore() {
      document.getElementById('score').textContent = `Skor: ${score}`;
    }

    function placeFood(){
      food = {
        x: Math.floor(Math.random()*tileCount),
        y: Math.floor(Math.random()*tileCount)
      };
      if(snake.some(s=>s.x===food.x&&s.y===food.y)) placeFood();
    }

    function resetGame(){
      snake = [{x:9,y:9},{x:8,y:9},{x:7,y:9}];
      velocity = {x:1,y:0};
      score = 0;
      updateScore();
      placeFood();
      drawGame();
    }

    function drawGame(){
      ctx.clearRect(0,0,canvas.width,canvas.height);
      snake.forEach(seg=>{
        ctx.fillStyle = 'rgba(255,255,255,0.85)';
        ctx.fillRect(seg.x*gridSize, seg.y*gridSize, gridSize,gridSize);
        ctx.font = `${gridSize-4}px serif`;
        ctx.textAlign = 'center'; ctx.textBaseline = 'middle';
        ctx.fillText(selectedAvatar, seg.x*gridSize+gridSize/2, seg.y*gridSize+gridSize/2+1);
      });
      if(food){
        ctx.fillStyle = '#ff4d4d';
        const px = food.x*gridSize, py = food.y*gridSize;
        ctx.beginPath();
        ctx.ellipse(px+gridSize/2,py+gridSize/2,gridSize/4,gridSize/4.5,0,0,2*Math.PI);
        ctx.fill();
        ctx.fillStyle = '#339933';
        ctx.beginPath();
        ctx.ellipse(px+gridSize/2+4,py+gridSize/2-10,4,7,-Math.PI/4,0,2*Math.PI);
        ctx.fill();
        ctx.strokeStyle='#663300'; ctx.lineWidth=1.5;
        ctx.beginPath();
        ctx.moveTo(px+gridSize/2+3, py+gridSize/2-7);
        ctx.lineTo(px+gridSize/2+6, py+gridSize/2-3);
        ctx.stroke();
      }
    }

    function checkCollision(){
      const [h,...body] = snake;
      return body.some(s=>s.x===h.x && s.y===h.y);
    }

    function gameOver(){
      clearInterval(gameInterval);
      alert(`Game Over! Skor kamu: ${score}`);
      document.getElementById('start-button').style.display = 'inline-block';
      document.getElementById('restart-button').style.display = 'none';
      gameStarted = false;
    }

    function gameLoop(){
      const head = {...snake[0]};
      head.x += velocity.x;
      head.y += velocity.y;
      if(head.x<0||head.x>=tileCount||head.y<0||head.y>=tileCount) return gameOver();
      snake.unshift(head);
      if(food && head.x===food.x && head.y===food.y){
        score++;
        updateScore();
        placeFood();
        showLoveText();
        soundEat.currentTime = 0;
        soundEat.play().catch(()=>{});
      } else snake.pop();
      if(checkCollision()) return gameOver();
      drawGame();
    }

    document.getElementById('start-button').addEventListener('click', () => {
      if(gameStarted) return;
      gameStarted = true;
      resetGame();
      gameInterval = setInterval(gameLoop, 140);
      document.getElementById('start-button').style.display = 'none';
      document.getElementById('restart-button').style.display = 'inline-block';
      soundClick.currentTime = 0;
      soundClick.play().catch(()=>{});
    });

    document.getElementById('restart-button').addEventListener('click', () => {
      clearInterval(gameInterval);
      resetGame();
      gameInterval = setInterval(gameLoop, 140);
      soundClick.currentTime = 0;
      soundClick.play().catch(()=>{});
    });

    document.getElementById('music-toggle').addEventListener('click', () => {
      if(bgMusic.paused) {
        bgMusic.play().catch(() => {});
        document.getElementById('music-toggle').textContent = 'Hentikan Musik Latar';
      } else {
        bgMusic.pause();
        document.getElementById('music-toggle').textContent = 'Putar Musik Latar';
      }
    });

    window.addEventListener('keydown', e => {
      if(!gameStarted) return;
      const k = e.key;
      if(k==='ArrowUp' && velocity.y!==1) velocity = {x:0,y:-1};
      if(k==='ArrowDown' && velocity.y!==-1) velocity = {x:0,y:1};
      if(k==='ArrowLeft' && velocity.x!==1) velocity = {x:-1,y:0};
      if(k==='ArrowRight' && velocity.x!==-1) velocity = {x:1,y:0};
    });

    // Joystick
    const joystick = document.getElementById('joystick');
    const stick = document.getElementById('stick');
    let dragging=false, startX, startY;
    joystick.addEventListener('pointerdown', e => {
      dragging = true;
      startX = e.clientX; startY = e.clientY;
      stick.style.transition='none';
    });
    window.addEventListener('pointermove', e => {
      if(!dragging) return;
      const dx = e.clientX - startX, dy = e.clientY - startY;
      const dist = Math.min(Math.hypot(dx,dy),40);
      const angle = Math.atan2(dy,dx);
      const x = Math.cos(angle)*dist;
      const y = Math.sin(angle)*dist;
      stick.style.transform = `translate(calc(-50% + ${x}px), calc(-50% + ${y}px))`;
      if(dist > 15) {
        if(Math.abs(dx)>Math.abs(dy)) {
          if(dx>0 && velocity.x!==-1) velocity={x:1,y:0};
          if(dx<0 && velocity.x!==1) velocity={x:-1,y:0};
        } else {
          if(dy>0 && velocity.y!==-1) velocity={x:0,y:1};
          if(dy<0 && velocity.y!==1) velocity={x:0,y:-1};
        }
      }
    });
    window.addEventListener('pointerup', () => {
      dragging=false;
      stick.style.transition='0.2s ease';
      stick.style.transform='translate(-50%,-50%)';
    });
  </script>
</body>
</html>
